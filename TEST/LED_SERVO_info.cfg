#####################################################################
# HW config for active LED extruder
     
[output_pin led_extruder]   
pin: PD12
value: 1

[output_pin led_extruder1]   
pin: PD13
value: 0

[output_pin led_extruder2]   
pin: PA10
value: 0

[output_pin led_extruder3]   
pin: PA9
value: 1

 
##################################################################### 
[gcode_macro _INIT_LED_SERVO_INFO]
gcode:
   
     {% set user_vars = printer["gcode_macro VARIABLE"] %}  
    
 {% if user_vars.switching_hotend.enable %} 
  
    {% set name = "switching_hotend" %}    
    {% set upd_init = user_vars.switching_hotend %}     
    
    ### define extruder for switching servo

   {% for index in user_vars.switching_hotend.name %}      
      {% set _dummy = upd_init.update( {upd_init.name[index]:[ ] }) %} 
   {% endfor %}

   {% for tool in user_vars.switching_hotend %}  
      {% if 'extruder' in tool %}    
         {% set name =  user_vars.switching_hotend[tool].servo %}
         {% set _dummy = upd_init[name].append( tool )  %}  
      {% endif %}
   {% endfor %}
      
    ### update variables 'switching_hotend'
      SET_GCODE_VARIABLE MACRO=VARIABLE VARIABLE={name} VALUE="{upd_init}"
     
   {% endif %}       

# add  .switching_hotend = 'tool_1': ['extruder', 'extruder1']
#                          'tool_2': ['extruder2', 'extruder3'] 
        
#####################################################################   
[gcode_macro LED_SERVO_INFO]
gcode:
   
     {% set user_vars = printer["gcode_macro VARIABLE"] %}

        {% set servo = params.S %}                # 'tool_1','tool_2' 
        {% set angle = params.A|int %}            #  45, 135 
                  
      {% for tool in user_vars.switching_hotend[servo] %}      
          SET_PIN PIN={'led_'+tool}     VALUE={1 if  angle ==  user_vars.switching_hotend[tool].angle else 0 }         # 45/135  
          # {action_respond_info("pin=%s valud=%s" % ('led_'+tool, 1 if  angle ==  user_vars.switching_hotend[tool].angle else 0 ))}
      {% endfor %}




      